model:
  name: PP-HumanSegV2-Lite
  nodes:
    - name: MobileNetV3
      params:
        variant: LARGE_X1_0
        in_channels: 3

    - name: MobileSegHead
      params:
        backbone_indices: [0, 1, 2]
        arm_out_chs: [32, 64, 128]
        cm_bin_sizes: [1, 2, 4]
        cm_out_ch: 128
        arm_type: UAFMMobile
        resize_mode: bilinear
        use_last_fuse: true
        seg_head_inter_chs: [16, 32, 32]

      inputs:
        - MobileNetV3

      losses:
        - name: MobileSegLoss
          params:
            ignore_index: 255
            coef: [0.8, 0.2]

      metrics:
        - name: JaccardIndex
          is_main_metric: true

      visualizers:
        - name: SegmentationVisualizer

loader:
  params:
    dataset_name: background_removal

trainer:
  preprocessing:
    train_image_size: [&height 256, &width 384]
    keep_aspect_ratio: false
    normalize:
      active: true
    augmentations:
      - name: Affine
        params:
          scale: [0.75, 1.25]
          rotate: [-45, 45]
          fill: 127.5
      - name: Blur
        params:
          p: 0.3
      - name: ColorJitter
      - name: HorizontalFlip
      - name: RandomCrop
        params:
          height: 256
          width: 384
          pad_if_needed: true
          pad_position: bottom_right

  n_sanity_val_steps: 0
  precision: 16-mixed
  batch_size: 16
  epochs: &epochs 200
  n_workers: 8
  validation_interval: 10
  n_log_images: 5

  optimizer:
    name: SGD
    params:
      lr: 0.003 #0.001
      momentum: 0.9
      weight_decay: 0.0005

  scheduler:
    name: PolynomialLR
    params:
      total_iters: *epochs
      power: 0.9